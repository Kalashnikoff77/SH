@inject DialogService DialogService

<PageTitle>Настройки учётной записи</PageTitle>

@page "/accountsettings"

<RadzenText TextStyle="TextStyle.H5" TextAlign="TextAlign.Left" class="rz-mb-6">Учётная запись</RadzenText>

@if (UpdatingModel != null)
{
    <RadzenTabs @bind-SelectedIndex=@selectedIndex Style="max-width: 700px">
        <Tabs>

            @* ОБЩЕЕ *@
            <RadzenTabsItem Text="Общее">
                <RadzenCard Variant="Variant.Filled" class="rz-my-6" Style="max-width: 750px">
                    <RadzenStack Orientation="Orientation.Vertical" Gap="0">
                        <RadzenText TextStyle="TextStyle.Subtitle2"><b>Имя учётной записи</b></RadzenText>
                        <RadzenTextBox @bind-Value=@UpdatingModel.Name MaxLength="StaticData.DB_ACCOUNTS_NAME_MAX" Style="width: 100%" />
                        <hr />
                        <RadzenText TextStyle="TextStyle.Subtitle2"><b>Адрес электронной почты</b></RadzenText>
                        <RadzenTextBox @bind-Value=@UpdatingModel.Email MaxLength="StaticData.DB_ACCOUNTS_EMAIL_MAX" Style="width: 100%" />
                        <hr />

                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeSM="6">
                                <RadzenStack Orientation="Orientation.Vertical" Gap="0">
                                    <RadzenText TextStyle="TextStyle.Subtitle2"><b>Страна</b></RadzenText>
                                    <RadzenDropDown @bind-Value=@countryId Data=@countries ValueProperty="@nameof(CountriesViewDto.Id)" TextProperty="@nameof(CountriesViewDto.Name)" Name="DropDownCountries" />
                                </RadzenStack>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeSM="6">
                                <RadzenStack Orientation="Orientation.Vertical" Gap="0">
                                    <RadzenText TextStyle="TextStyle.Subtitle2"><b>Город</b></RadzenText>
                                    <RadzenDropDown @bind-Value=@regionId Data=@regions ValueProperty="@nameof(RegionsDto.Id)" TextProperty="@nameof(RegionsDto.Name)" Name="DropDownRegions" />
                                </RadzenStack>
                            </RadzenColumn>
                        </RadzenRow>

                    </RadzenStack>
                </RadzenCard>
            </RadzenTabsItem>

            @* ПАРТНЁРЫ *@
            <RadzenTabsItem Text="Партнёры">
                <RadzenCard Variant="Variant.Filled" class="rz-my-6" Style="max-width: 750px">

                    <RadzenDataGrid @ref="usersGrid" AllowAlternatingRows="false" AllowFiltering="false" AllowPaging="false" AllowSorting="false" EditMode="DataGridEditMode.Single"
                                    Data="@UpdatingModel.Users" TItem="UsersDto" EmptyText="Добавьте от 1 до 4 партнёров...">
                        <Columns>
                            <RadzenDataGridColumn Property="GenderAge" Title="Партнёр">
                                <Template Context="user">
                                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="6">
                                        <RadzenIcon Visible="user.Gender == 1" IconStyle="IconStyle.Primary" Style="font-size: 35px" Icon="Woman" />
                                        <RadzenIcon Visible="user.Gender == 0" IconStyle="IconStyle.Secondary" Style="font-size: 35px" Icon="Man" />
                                        <RadzenText><b>@user.Name</b><br />@user.ToGenderAgeString() @user.Height/@user.Weight</RadzenText>
                                    </RadzenStack>
                                </Template>
                            </RadzenDataGridColumn>

                            <RadzenDataGridColumn Context="user" Width="110px" MinWidth="110px" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Frozen="true" FrozenPosition="FrozenColumnPosition.Right">
                                <Template Context="user">
                                    <RadzenButton Click=@(() => OpenEditUserForm(user)) Icon="edit" ButtonStyle="ButtonStyle.Base" Variant="Variant.Flat" Size="ButtonSize.Medium" @onclick:stopPropagation="true" />
                                    <RadzenButton Click="@(args => DeleteRow(user))" ButtonStyle="ButtonStyle.Danger" Icon="delete" Variant="Variant.Flat" Shade="Shade.Lighter" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" @onclick:stopPropagation="true" />
                                </Template>
                            </RadzenDataGridColumn>
                        </Columns>
                    </RadzenDataGrid>

                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.Right" class="rz-mt-3">
                        <RadzenButton ButtonStyle="ButtonStyle.Secondary" Disabled="UpdatingModel.Users.Count > 3" Size="ButtonSize.Small" Icon="add_circle" Text="Добавить" Click=@(() => OpenEditUserForm(null)) />
                    </RadzenStack>
                </RadzenCard>
            </RadzenTabsItem>

            <RadzenTabsItem Text="Фото">
                Фото
            </RadzenTabsItem>

            <RadzenTabsItem Text="Уведомления">
                Уведомления
            </RadzenTabsItem>
        </Tabs>
    </RadzenTabs>
}