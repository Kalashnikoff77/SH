<MudDialog>
    <TitleContent>Добавление расписания</TitleContent>

    <DialogContent>
        <MudStack AlignItems="AlignItems.Center" Class="mb-2">
            <MudText Typo="Typo.h6">Выберите тип мероприятия</MudText>
            <MudRadioGroup @bind-Value="EventType">
                <MudRadio Value="true" Color="Color.Primary" Dense>Разовое</MudRadio>
                <MudRadio Value="false" Color="Color.Secondary" Dense>Повторяющееся</MudRadio>
            </MudRadioGroup>
        </MudStack>

        @* Разовое *@
        @if (EventType)
        {
            <MudGrid Spacing="3">
                <MudItem sm="6" xs="12">
                    <MudDatePicker Label="Дата начала"
                                   Date="StartDate"
                                   DateChanged="(startDate) => StartDate = startDate"
                                   Mask="@(new DateMask("dd.MM.yyyy"))" DateFormat="dd.MM.yyyy"
                                   AdornmentIcon="@Icons.Material.Filled.CalendarMonth" AdornmentColor="@StartDateIconColor" Adornment="Adornment.End"
                                   Validation="@(new Func<DateTime?, string?>(StartDateValidator))"
                                   OpenTo="OpenTo.Date"
                                   MinDate="DateTime.Now"
                                   MaxDate="DateTime.Now.AddDays(maxStartDateDays)"
                                   HelperText="@($"Не позднее {DateTime.Now.AddDays(maxStartDateDays).ToString("dd.MM.yyyy")}")" ShowToolbar="false" />
                </MudItem>
                <MudItem sm="6" xs="12">
                    <MudTimePicker Label="Время начала" Editable="false" @bind-Time="StartTime" MinuteSelectionStep="5"
                                   AdornmentIcon="@Icons.Material.Filled.AccessTime" AdornmentColor="@StartTimeIconColor" Adornment="Adornment.End"
                                   HelperText="Пример: 19:00" />
                </MudItem>

                <MudItem sm="6" xs="12">
                    <MudDatePicker Label="Дата окончания"
                                   Date="EndDate"
                                   DateChanged="(endDate) => EndDate = endDate"
                                   Mask="@(new DateMask("dd.MM.yyyy"))" DateFormat="dd.MM.yyyy"
                                   AdornmentIcon="@Icons.Material.Filled.CalendarMonth" AdornmentColor="@EndDateIconColor" Adornment="Adornment.End"
                                   Validation="@(new Func<DateTime?, string?>(EndDateValidator))"
                                   OpenTo="OpenTo.Date"
                                   StartMonth="StartDate"
                                   MinDate="Schedule.StartDate == DateTime.MinValue ? DateTime.Now : Schedule.StartDate"
                                   MaxDate="Schedule.StartDate == DateTime.MinValue ? DateTime.Now : Schedule.StartDate.AddDays(maxEndDateDays)"
                                   HelperText="@(StartDate.HasValue ? $"Не позднее {StartDate!.Value.AddDays(maxEndDateDays).ToString("dd.MM.yyyy")}" : "Выберите начальную дату")" ShowToolbar="false" />
                </MudItem>
                <MudItem sm="6" xs="12">
                    <MudTimePicker Label="Время окончания" Editable="false" @bind-Time="EndTime" MinuteSelectionStep="5"
                                   AdornmentIcon="@Icons.Material.Filled.AccessTime" AdornmentColor="@EndTimeIconColor" Adornment="Adornment.End"
                                   HelperText="Пример: 23:30" />
                </MudItem>

            </MudGrid>
        }

        @* Повторяющееся *@
        else
        {
            <MudGrid Spacing="3">
                <MudItem sm="6" xs="12">
                    <MudDatePicker Label="Дата начала"
                                   Date="StartDate"
                                   DateChanged="(startDate) => StartDate = startDate"
                                   Mask="@(new DateMask("dd.MM.yyyy"))" DateFormat="dd.MM.yyyy"
                                   AdornmentIcon="@Icons.Material.Filled.CalendarMonth" AdornmentColor="@StartDateIconColor" Adornment="Adornment.End"
                                   Validation="@(new Func<DateTime?, string?>(StartDateValidator))"
                                   OpenTo="OpenTo.Date"
                                   MinDate="DateTime.Now"
                                   MaxDate="DateTime.Now.AddDays(maxStartDateDays)"
                                   HelperText="@($"Не позднее {DateTime.Now.AddDays(maxStartDateDays).ToString("dd.MM.yyyy")}")" ShowToolbar="false" />
                </MudItem>
                <MudItem sm="6" xs="12">
                    <MudDatePicker Label="Дата окончания"
                                   Date="EndDate"
                                   DateChanged="(endDate) => EndDate = endDate"
                                   Mask="@(new DateMask("dd.MM.yyyy"))" DateFormat="dd.MM.yyyy"
                                   AdornmentIcon="@Icons.Material.Filled.CalendarMonth" AdornmentColor="@EndDateIconColor" Adornment="Adornment.End"
                                   Validation="@(new Func<DateTime?, string?>(EndDateValidator))"
                                   OpenTo="OpenTo.Date"
                                   StartMonth="StartDate"
                                   MinDate="Schedule.StartDate == DateTime.MinValue ? DateTime.Now : Schedule.StartDate"
                                   MaxDate="Schedule.StartDate == DateTime.MinValue ? DateTime.Now : Schedule.StartDate.AddDays(maxEndDateDays)"
                                   HelperText="@(StartDate.HasValue ? $"Не позднее {StartDate!.Value.AddDays(maxEndDateDays).ToString("dd.MM.yyyy")}" : "Выберите начальную дату")" ShowToolbar="false" />
                </MudItem>

                <MudItem sm="6" xs="12">
                    <MudTimePicker Label="Время начала" Editable="false" @bind-Time="StartTime" MinuteSelectionStep="5"
                                   AdornmentIcon="@Icons.Material.Filled.AccessTime" AdornmentColor="@EndTimeIconColor" Adornment="Adornment.End"
                                   HelperText="Пример: 19:00" />
                </MudItem>
                <MudItem sm="6" xs="12">
                    <MudTimePicker Label="Время окончания" Editable="false" @bind-Time="EndTime" MinuteSelectionStep="5"
                                   AdornmentIcon="@Icons.Material.Filled.AccessTime" AdornmentColor="@EndTimeIconColor" Adornment="Adornment.End"
                                   HelperText="Пример: 23:30" />
                </MudItem>

                <MudItem xs="12">
                    <MudText Align="Align.Center" Typo="Typo.subtitle1">Повторять в указанные дни недели:</MudText>
                    <MudStack Row Wrap="Wrap.Wrap" Spacing="6" Justify="Justify.Center">
                        <MudCheckBox @bind-Value="DaysOfWeek[0]" Label="Пн" Dense Color="Color.Primary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[1]" Label="Вт" Dense Color="Color.Primary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[2]" Label="Ср" Dense Color="Color.Primary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[3]" Label="Чт" Dense Color="Color.Primary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[4]" Label="Пт" Dense Color="Color.Primary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[5]" Label="Сб" Dense Color="Color.Secondary"></MudCheckBox>
                        <MudCheckBox @bind-Value="DaysOfWeek[6]" Label="Вс" Dense Color="Color.Secondary"></MudCheckBox>
                    </MudStack>
                </MudItem>
            </MudGrid>
        }

    </DialogContent>

    <DialogActions>
        <MudButton Color="Color.Error" StartIcon="@Icons.Material.Outlined.Close" OnClick="Cancel">Отмена</MudButton>
        <MudButton Color="Color.Primary" Disabled="!IsFormValid" Variant="Variant.Filled" StartIcon="@Icons.Material.Outlined.Add" Size="Size.Small" OnClick="Submit">Добавить</MudButton>
    </DialogActions>
</MudDialog>
