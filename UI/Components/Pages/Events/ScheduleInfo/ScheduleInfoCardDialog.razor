@if (ScheduleForEventView?.Event != null)
{
    <MudDialog Style="width:550px; min-width:300px">
        <DialogContent>
            <div id="top" class="d-flex flex-column mb-3 align-center" style="overflow-y:visible">
                <MudCarousel @ref="Carousel" TData="PhotosForEventsDto" ShowArrows ShowBullets="false" AutoCycle Style="width:300px; height:400px" Class="mb-3">
                    @if (ScheduleForEventView.Event.Photos != null)
                    {
                        @foreach (var photo in ScheduleForEventView.Event.Photos.OrderByDescending(o => o.IsAvatar).ThenByDescending(o => o.CreateDate))
                        {
                            <MudCarouselItem Transition="Transition.Slide">
                                <MudImage Src=@($"/images/EventsPhotos/{photo.RelatedId}/{photo.Guid}/{EnumImageSize.s450x600}.jpg") Fluid="true" Style="border-radius:2%" />
                            </MudCarouselItem>
                        }
                    }
                </MudCarousel>

                <MudStack Spacing="2" Row Style="width:100%" StretchItems="StretchItems.Start" Justify="Justify.Center" AlignItems="AlignItems.Center">
                    @if (scheduleDates != null)
                    {
                        <MudSelect T="SchedulesDatesViewDto" Value="selectedSchedule" ValueChanged="ScheduleChangedAsync" Variant="Variant.Outlined" Dense AnchorOrigin="Origin.BottomCenter" Margin="Margin.Dense" Label="Расписание" AdornmentIcon="@Icons.Material.Outlined.CalendarMonth">
                            @foreach (var schedule in scheduleDates)
                            {
                                <MudSelectItem Value="@schedule" />
                            }
                        </MudSelect>
                    }

                    @if (CurrentState.Account != null)
                    {
                        @if (CurrentState.Account.Schedules != null && CurrentState.Account.Schedules.Any(a => a.ScheduleId == ScheduleForEventView.Id)) 
                        {
                            <MudButton OnClick="() => ShowDialogs.CancelRegistrationForEventDialogAsync(ScheduleForEventView)" Style="height:39px; margin:2px 3px 0 0; padding: 0 20px" Color="Color.Primary" IconSize="Size.Large" Size="Size.Small" StartIcon="@Icons.Material.Outlined.GroupRemove" Variant="Variant.Filled" title="Отменить регистрацию">Отменить</MudButton>
                        }
                        else
                        {
                            <MudButton OnClick="() => ShowDialogs.RegistrationForEventDialogAsync(ScheduleForEventView)" Style="height:39px; margin:2px 3px 0 0; padding: 0 20px" Color="Color.Primary" IconSize="Size.Large" Size="Size.Small" StartIcon="@Icons.Material.Outlined.GroupAdd" Variant="Variant.Outlined" title="Зарегистрироваться на мероприятие">Регистрация</MudButton>
                        }
                    }
                </MudStack>

                @* Закладки *@
                <MudTabs Centered PanelClass="mt-6 px-2" Style="width:100%">
                    <MudTabPanel Text="Общее">
                        <Tab_About ScheduleForEventView="@ScheduleForEventView" />
                    </MudTabPanel>

                    <MudTabPanel Text="Обсуждение" BadgeData="@ScheduleForEventView.Event.Statistic?.NumOfDiscussions" BadgeColor="Color.Transparent">
                        <Tab_Discussions ScheduleForEventView="@ScheduleForEventView" />
                    </MudTabPanel>

                    <MudTabPanel Text="Участники" Disabled="@(ScheduleForEventView.Statistic?.NumOfRegAccounts == 0)" BadgeData="@ScheduleForEventView.Statistic?.NumOfRegAccounts" BadgeColor="Color.Transparent">
                        <Tab_Accounts ScheduleForEventView="@ScheduleForEventView" />
                    </MudTabPanel>
                </MudTabs>
            </div>
        </DialogContent>

        <DialogActions>
            @if (CurrentState.Account?.Id == ScheduleForEventView.Event.Admin?.Id)
            {
                <MudButton Href="@($"/events/edit/{ScheduleForEventView.EventId}")" Color="Color.Primary">Редактировать</MudButton>
            }
            <MudButton Color="Color.Error" OnClick="() => MudDialog.Close(DialogResult.Ok(true))">Закрыть</MudButton>
        </DialogActions>
    </MudDialog>
}
