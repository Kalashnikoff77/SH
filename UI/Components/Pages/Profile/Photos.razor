@page "/profile/photos"

@if (CurrentState.Account != null)
{
    <PageTitle>Фотографии: @CurrentState.Account.Name</PageTitle>

    <MudText Align="Align.Left" Typo="Typo.h6" Class="mb-3">Фотографии: @CurrentState.Account.Name</MudText>
    <MudDivider DividerType="DividerType.FullWidth" Light="false" Class="mb-8" />

    <MudStack Style="min-width:300px; max-width:750px" Class="ml-0">

        <MudStack Row Justify="Justify.Center" class="mb-5">
            <MudFileUpload T="IReadOnlyList<IBrowserFile>" MaximumFileCount="50" Accept=".jpg,.jpeg,.png" FilesChanged="UploadPhotos">
                <ActivatorContent>
                    <MudButton Disabled="processingPhoto" Size="Size.Small" Variant="Variant.Outlined" Color="Color.Primary" StartIcon="@Icons.Material.Sharp.Upload">
                        @if (processingPhoto)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                            <MudText Class="ms-2">Обработка фото...</MudText>
                        } 
                        else
                        {
                            <MudText>Добавить фотографии</MudText>
                        }
                    </MudButton>
                </ActivatorContent>
            </MudFileUpload>
        </MudStack>

        @if (CurrentState.Account.Photos != null)
        {
            <MudStack Row Wrap="Wrap.Wrap" Spacing="0" Justify="Justify.SpaceEvenly">
                @foreach (var photo in CurrentState.Account.Photos)
                {
                    @if (photo.IsAvatar)
                    {
                        avatarBackground = "background-color:#EDFFEE";
                    }
                    else
                    {
                        avatarBackground = null;
                    }
                    <MudPaper Outlined class="pa-3 mb-8" style="@("max-width:274px; " + avatarBackground)">
                        <MudStack>
                            <MudImage Width="250" Height="250" Src="@("/images/AccountsPhotos/" + CurrentState.Account.Id + "/" + photo.Guid + "/" + EnumImageSize.s250x250.ToString() + ".jpg")" />
                            
                            <MudStack Row>
                                <MudTextField @bind-Value="@photo.Comment" Label="Описание" Variant="Variant.Text" />
                                <MudMenu Icon="@Icons.Material.Filled.MoreVert" Size="Size.Small" AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopCenter" Dense>
                                    @if (photo.IsAvatar)
                                    {
                                        <MudMenuItem OnClick="@(() => SetAvatar(photo))" Icon="@Icons.Material.Filled.Portrait">Отменить аватар</MudMenuItem>
                                    }
                                    else
                                    {
                                        <MudMenuItem OnClick="@(() => SetAvatar(photo))" Icon="@Icons.Material.Filled.Portrait">Установить как аватар</MudMenuItem>
                                    }
                                    <MudMenuItem OnClick="@(() => Delete(photo))" IconColor="Color.Error" Icon="@Icons.Material.Outlined.Delete">Удалить</MudMenuItem>
                                </MudMenu>
                            </MudStack>
                        
                        </MudStack>
                    </MudPaper>
                }
            </MudStack>
        }
    </MudStack>
}
