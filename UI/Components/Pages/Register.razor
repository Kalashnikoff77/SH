@inject DialogService DialogService

@page "/register"
<PageTitle>Регистрация</PageTitle>

<RadzenCard Variant="Variant.Filled" Class="rz-my-12 rz-mx-auto" Style="max-width: 500px">

    <RadzenText TextAlign="TextAlign.Center" TextStyle="TextStyle.H6">Регистрация</RadzenText>

    <RadzenSteps Change="@OnChange" CanChange="@CanChange" NextText="Далее" NextTitle="К следующему шагу" PreviousText="Назад" PreviousTitle="К предыдущему шагу">
        <Steps>
            @* Шаг первый - общее *@
            <RadzenStepsItem>
                <RadzenStack Orientation="Orientation.Vertical" Gap="0">
                    <RadzenText TextStyle="TextStyle.Subtitle2"><b>Имя Вашей учётной записи</b></RadzenText>
                    <RadzenTextBox @bind-Value=@RegisterModel.Name MaxLength="40" Style="width: 100%" />
                    <hr />
                    <RadzenText TextStyle="TextStyle.Subtitle2"><b>Адрес электронной почты</b></RadzenText>
                    <RadzenTextBox @bind-Value=@RegisterModel.Email MaxLength="75" Style="width: 100%" />
                    <hr />
                    
                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Wrap="FlexWrap.Wrap" Style="width: 100%">
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Style="width: 50%">
                            <RadzenStack Orientation="Orientation.Vertical" Gap="0" Style="width: 100%">
                                <RadzenText TextStyle="TextStyle.Subtitle2"><b>Пароль</b></RadzenText>
                                <RadzenPassword @bind-Value=@RegisterModel.Password MaxLength="35" Style="width: 99%" />
                            </RadzenStack>
                        </RadzenStack>
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Style="width: 50%">
                            <RadzenStack Orientation="Orientation.Vertical" Gap="0" Style="width: 100%">
                                <RadzenText TextStyle="TextStyle.Subtitle2"><b>Повтор пароля</b></RadzenText>
                                <RadzenPassword @bind-Value=@RegisterModel.Password2 MaxLength="35" Style="width: 99%" />
                            </RadzenStack>
                        </RadzenStack>
                    </RadzenStack>
                    <hr />

                    <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Wrap="FlexWrap.Wrap" Style="width: 100%">
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Style="width: 50%">
                            <RadzenStack Orientation="Orientation.Vertical" Gap="0" Style="width: 100%">
                                <RadzenText TextStyle="TextStyle.Subtitle2"><b>Страна</b></RadzenText>
                                <RadzenDropDown @bind-Value=@countryId Data=@countries ValueProperty="@nameof(CountriesViewDto.Id)" TextProperty="@nameof(CountriesViewDto.Name)" Style="width: 99%" Name="DropDownCountries" />
                            </RadzenStack>
                        </RadzenStack>
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Style="width: 50%">
                            <RadzenStack Orientation="Orientation.Vertical" Gap="0" Style="width: 100%">
                                <RadzenText TextStyle="TextStyle.Subtitle2"><b>Город</b></RadzenText>
                                <RadzenDropDown @bind-Value=@regionId Data=@regions ValueProperty="@nameof(RegionsDto.Id)" TextProperty="@nameof(RegionsDto.Name)" Style="width: 99%" Name="DropDownRegions" />
                            </RadzenStack>
                        </RadzenStack>
                    </RadzenStack>
                </RadzenStack>
            </RadzenStepsItem>

            @* Шаг второй - аватар *@
            <RadzenStepsItem>
                <RadzenStack AlignItems="AlignItems.Center">
                    <RadzenCard Style="width: 100%; max-width: 600px;">
                        <RadzenText TextStyle="TextStyle.H6" TextAlign="TextAlign.Center"><strong>@RegisterModel.Name</strong></RadzenText>
                        <RadzenFileInput
                            @bind-Value=@RegisterModel.Photo
                            @bind-FileName=@fileName 
                            @bind-FileSize=@fileSize
                            TValue="string"
                            Style="width: 100%; text-align: center"
                            ChooseText="Выберите фото для аватара"
                            Change=@(args => OnChange(args, "FileInput")) Error=@(args => OnError(args, "FileInput")) InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "select file" }})" />
                    </RadzenCard>
                </RadzenStack>
            </RadzenStepsItem>


            @* Шаг третий - партнёры *@
            <RadzenStepsItem>
                <RadzenStack Orientation="Orientation.Vertical" Gap="0">

                    @foreach(var user in RegisterModel.Users)
                    {
                        <RadzenStack Orientation="Orientation.Horizontal" Gap="0">
                            <RadzenStack Orientation="Orientation.Vertical" Style="width: 99%" Gap="0">
                                <RadzenText TextStyle="TextStyle.Subtitle2"><b>Имя партнёра</b></RadzenText>
                                <RadzenTextBox @bind-Value=user.Name MaxLength="35" />
                            </RadzenStack>
                            <RadzenStack Orientation="Orientation.Vertical" JustifyContent="JustifyContent.Center" class="rz-ml-2" Gap="0">
                                <RadzenButton Text="-" ButtonStyle="ButtonStyle.Danger" Click="() => DeleteUser(user)" />
                            </RadzenStack>
                        </RadzenStack>
                        <hr />
                    }
                    <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceAround" Gap="0">
                        <RadzenButton Text="+" Style="width: 20%" ButtonStyle="ButtonStyle.Success" Click="AddUser" />
                    </RadzenStack>
                </RadzenStack>

                <hr />
                <RadzenStack Orientation="Orientation.Vertical" Gap="0">
                    <RadzenButton Text="Зарегистрироваться" />
                </RadzenStack>
            </RadzenStepsItem>

        </Steps>
    </RadzenSteps>

</RadzenCard>
